<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Game Room</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Canvas for the game -->
    <canvas id="gameCanvas"></canvas>

    <!-- Chat Box -->
    <div id="chatBox">
        <input id="chatInput" type="text" placeholder="Type a message..." />
        <button id="sendButton">Send</button>
    </div>

    <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
    <script>
        const socket = io("https://common-verdant-boa.glitch.me/game");

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const chatInput = document.getElementById("chatInput");
        const sendButton = document.getElementById("sendButton");

        let players = {};
        const avatarImage = new Image();
        avatarImage.src = "./avatar.png"; // Adjust the path as needed

        // Dynamically resize the canvas to match the width of the text input
        function resizeCanvas() {
            const chatBoxWidth = chatInput.offsetWidth + sendButton.offsetWidth; // Combined width of input and button
            canvas.width = chatBoxWidth;
            canvas.height = chatBoxWidth; // Make it a square
        }

        resizeCanvas(); // Initial resize
        window.addEventListener("resize", resizeCanvas); // Adjust on window resize

        // Handle message sending
        sendButton.onclick = () => {
            const message = chatInput.value.trim();
            if (message) {
                socket.emit("message", message);
                chatInput.value = "";

                // Keep the keyboard open by refocusing the input field
                chatInput.focus();
            }
        };

        // Fix layout when keyboard opens
        chatInput.addEventListener("focus", () => {
            document.body.style.height = `${window.innerHeight}px`; // Prevent layout shift
        });

        // Update players from the server
        socket.on("update-players", (serverPlayers) => {
            players = serverPlayers;
            draw();
        });

        // Notify user if the game room is full
        socket.on("full", (message) => {
            alert(message);
        });

        // Draw the game
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (const id in players) {
                const player = players[id];

                // Draw player avatar
                ctx.drawImage(avatarImage, player.x - 25, player.y - 25, 50, 50); // Adjust size and position

                // Draw message with larger font
                if (player.message) {
                    ctx.font = "18px Arial"; // Match the CSS styling
                    ctx.fillStyle = "#9d174d"; // Deep pink color
                    ctx.textAlign = "center";
                    ctx.fillText(player.message, player.x, player.y - 40); // Position above avatar
                }
            }
        }

    </script>
</body>
</html>
