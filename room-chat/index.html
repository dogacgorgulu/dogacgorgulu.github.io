<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Game Room</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- Movement Controls for Mobile -->
    <div id="controls">
        <button id="up">⬆️</button>
        <div>
            <button id="left">⬅️</button>
            <button id="down">⬇️</button>
            <button id="right">➡️</button>
        </div>
    </div>

    <!-- Chat Box -->
    <div id="chatBox">
        <input id="chatInput" type="text" placeholder="Type a message..." />
        <button id="sendButton">Send</button>
    </div>

    <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
    <script>
        const socket = io("https://common-verdant-boa.glitch.me/game");

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const chatInput = document.getElementById("chatInput");
        const sendButton = document.getElementById("sendButton");

        // Movement controls for mobile
        const upButton = document.getElementById("up");
        const downButton = document.getElementById("down");
        const leftButton = document.getElementById("left");
        const rightButton = document.getElementById("right");

        // Fixed canvas size
        const canvasWidth = 600;
        const canvasHeight = 400;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        let players = {};
        const speed = 5;

        // Emit movement to the server
        function emitMove(x, y) {
            socket.emit("move", { x, y });
        }

        // Keyboard movement for desktop
        window.addEventListener("keydown", (e) => {
            if (chatInput === document.activeElement) return; // Ignore if typing
            if (e.key === "ArrowUp") emitMove(0, -speed);
            if (e.key === "ArrowDown") emitMove(0, speed);
            if (e.key === "ArrowLeft") emitMove(-speed, 0);
            if (e.key === "ArrowRight") emitMove(speed, 0);
        });

        // Movement controls for mobile
        upButton.onclick = () => emitMove(0, -speed);
        downButton.onclick = () => emitMove(0, speed);
        leftButton.onclick = () => emitMove(-speed, 0);
        rightButton.onclick = () => emitMove(speed, 0);

        // Handle message sending
        sendButton.onclick = () => {
            const message = chatInput.value.trim();
            if (message) {
                socket.emit("message", message);
                chatInput.value = "";
            }
        };

        // Update players from the server
        socket.on("update-players", (serverPlayers) => {
            players = serverPlayers;
            draw();
        });

        // Draw the game
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (const id in players) {
                const player = players[id];
                // Draw player
                ctx.beginPath();
                ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
                ctx.fillStyle = id === socket.id ? "rgb(245, 99, 200)" : "rgb(189, 195, 199)"; // Cold pink for local player
                ctx.fill();

                // Draw message
                if (player.message) {
                    ctx.font = "16px Arial";
                    ctx.fillStyle = "rgb(245, 99, 200)";
                    ctx.textAlign = "center";
                    ctx.fillText(player.message, player.x, player.y - 30);
                }
            }
        }

        // Prevent the keyboard from closing
        chatInput.addEventListener("focus", () => {
            document.body.style.height = `${window.innerHeight}px`; // Prevent layout shift
        });

        // Resize canvas and layout on window resize
        window.addEventListener("resize", () => {
            document.body.style.height = `${window.innerHeight}px`;
        });
    </script>
</body>
</html>

