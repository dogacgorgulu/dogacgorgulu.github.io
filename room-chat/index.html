<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Game Room</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Canvas for the game -->
    <canvas id="gameCanvas"></canvas>

    <!-- Chat Box -->
    <div id="chatBox">
        <input id="chatInput" type="text" placeholder="Type a message..." />
        <button id="sendButton">Send</button>
    </div>

    <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
    <script>
        const socket = io("https://common-verdant-boa.glitch.me/game");

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const chatInput = document.getElementById("chatInput");
        const sendButton = document.getElementById("sendButton");

        let players = {};
        const speed = 5;

        // Dynamically resize the canvas to match the width of the text input
        function resizeCanvas() {
            const chatBoxWidth = chatInput.offsetWidth + sendButton.offsetWidth; // Combined width of input and button
            canvas.width = chatBoxWidth;
            canvas.height = chatBoxWidth; // Make it a square
        }

        resizeCanvas(); // Initial resize
        window.addEventListener("resize", resizeCanvas); // Adjust on window resize

        // Emit movement to the server
        function emitMove(x, y) {
            socket.emit("move", { x, y });
        }

        // Keyboard movement for desktop
        window.addEventListener("keydown", (e) => {
            if (chatInput === document.activeElement) return; // Ignore if typing
            if (e.key === "ArrowUp") emitMove(0, -speed);
            if (e.key === "ArrowDown") emitMove(0, speed);
            if (e.key === "ArrowLeft") emitMove(-speed, 0);
            if (e.key === "ArrowRight") emitMove(speed, 0);
        });

        // Handle message sending
        sendButton.onclick = () => {
            const message = chatInput.value.trim();
            if (message) {
                socket.emit("message", message);
                chatInput.value = "";
            }
        };

        // Update players from the server
        socket.on("update-players", (serverPlayers) => {
            players = serverPlayers;
            draw();
        });

        // Draw the game
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (const id in players) {
                const player = players[id];
                // Draw player
                ctx.beginPath();
                ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
                ctx.fillStyle = id === socket.id ? "rgb(245, 99, 200)" : "rgb(189, 195, 199)"; // Cold pink for local player
                ctx.fill();

                // Draw message
                if (player.message) {
                    ctx.font = "16px Arial";
                    ctx.fillStyle = "rgb(245, 99, 200)";
                    ctx.textAlign = "center";
                    ctx.fillText(player.message, player.x, player.y - 30);
                }
            }
        }
    </script>
</body>
</html>


